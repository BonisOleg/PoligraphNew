# Правила для Cursor AI - PolygraphNew Project

## СТЕК ПРОЕКТУ

- Django (backend)
- HTML + HTMX (frontend інтерактивність)
- normalize.css v12.1.1 (CSS нормалізація)
- Vanilla CSS (стилізація)
- Vanilla JavaScript (мінімально, де необхідно)

**ПІДТРИМУВАНІ БРАУЗЕРИ:** Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ (2021+)

---

## КРИТИЧНІ ПРАВИЛА ДЛЯ CSS

### ⚠️ НЕДОТОРКАННІСТЬ normalize.css ⚠️

**АБСОЛЮТНА ЗАБОРОНА:**
- НІКОЛИ не змінювати файл `static/css/normalize.css`
- НІКОЛИ не редагувати файл `static/css/normalize.css`
- НІКОЛИ не коментувати рядки в `static/css/normalize.css`
- НІКОЛИ не видаляти рядки з `static/css/normalize.css`
- НІКОЛИ не додавати нові правила в `static/css/normalize.css`

**ЄДИНА ДОЗВОЛЕНА ДІЯ:**
- Оновлення до нової версії (повна заміна вмісту файлу)

### Порядок підключення CSS (КРИТИЧНО, НЕ ПОРУШУВАТИ)

1. normalize.css - ЗАВЖДИ перший
2. base.css - базові стилі проекту
3. components/*.css - компоненти
4. utilities/*.css - утиліти
5. page-specific.css - стилі конкретних сторінок

### Заборонено в CSS

- Дублювати правила з normalize.css
- Використовувати !important для перевизначення normalize
- Inline styles (style="")
- Глобальні селектори типу * { } після normalize
- Використання ID для стилізації (тільки класи)

### Обов'язково в CSS

- Використовувати специфічність замість !important
- Використовувати BEM методологію для naming класів
- Перевіряти на конфлікти перед додаванням нового CSS
- Використовувати CSS custom properties для кольорів/відступів (DRY)
- Всі CSS зміни ТІЛЬКИ в файлах після normalize.css

### Структура CSS файлів

- `static/css/normalize.css` - недоторканний
- `static/css/base.css` - базові стилі проекту
- `static/css/components/*.css` - компоненти (BEM)
- `static/css/utilities/*.css` - утилітарні класи

---

## КРИТИЧНІ ПРАВИЛА ДЛЯ HTMX

### ⚠️ Порядок підключення скриптів (КРИТИЧНО)

**В templates/base.html:**
1. CSS файли (normalize.css перший)
2. CSRF token meta tag
3. HTMX (з defer)
4. Власні JS файли (з defer, в блоці scripts)

### Абсолютна заборона для HTMX

- НІКОЛИ не змінювати порядок підключення (CSS перші, потім HTMX)
- НІКОЛИ не використовувати HTMX для зміни CSS стилів
- НІКОЛИ не додавати inline styles через HTMX
- НІКОЛИ не змішувати HTMX з іншими AJAX бібліотеками (jQuery, Axios, тощо)
- НІКОЛИ не використовувати HTMX без CSRF token для POST/PUT/DELETE
- НІКОЛИ не видаляти атрибут defer з HTMX скрипта
- НІКОЛИ не блокувати завантаження скриптами (завжди defer)

### Обов'язково для HTMX

- HTMX підключається ПІСЛЯ всіх CSS файлів
- HTMX з атрибутом defer (неблокуюче завантаження)
- Використовувати ТІЛЬКИ офіційні HTMX атрибути (hx-get, hx-post, hx-target, hx-swap, тощо)
- CSRF token для всіх форм з HTMX (через meta tag або hx-headers)
- Правильні HTTP методи (GET для читання, POST для створення/зміни)
- Django views повертають HTML фрагменти, а не JSON

### HTMX best practices

- Використовувати hx-target для вказівки, куди вставити результат
- Використовувати hx-swap для контролю способу вставки
- Використовувати hx-trigger для контролю подій
- Використовувати hx-indicator для показу індикаторів завантаження
- Уникати дублювання функціональності (якщо можна через HTMX - використовувати HTMX)

---

## КРИТИЧНІ ПРАВИЛА ОПТИМІЗАЦІЇ

### Заборонені бібліотеки (НЕ ДОДАВАТИ БЕЗ УЗГОДЖЕННЯ)

- ❌ jQuery - непотрібна, використовувати HTMX
- ❌ core-js / polyfill.io - непотрібні для сучасних браузерів
- ❌ Modernizr - непотрібний для сучасних браузерів
- ❌ Bootstrap JS - конфліктує з HTMX, використовувати тільки CSS якщо потрібно
- ❌ Будь-які інші великі JS бібліотеки без явної необхідності

### Обов'язкова оптимізація

- Всі скрипти з атрибутом defer
- preconnect та dns-prefetch для CDN
- НЕ дублювати функціональність між бібліотеками
- Використовувати CDN з integrity для безпеки
- Мінімізувати кількість HTTP запитів

---

## DJANGO ПРАВИЛА

### Static Files

- Використовувати {% load static %} в шаблонах
- Використовувати {% static 'path/to/file' %} для підключення
- Переконатися, що normalize.css підключається першим у <head>
- STATIC_URL, STATICFILES_DIRS, STATIC_ROOT налаштовані в settings.py

### CSRF для HTMX

- Додати meta tag з CSRF token в base.html
- Використовувати hx-headers або автоматичну конфігурацію для HTMX

### Django Views для HTMX

- Повертати HTML фрагменти (render partial templates)
- Правильні HTTP статуси (200 OK, 422 Unprocessable Entity для валідації)
- Використовувати Django forms для валідації

---

## ПЕРЕВІРКА ПЕРЕД ДОДАВАННЯМ КОДУ

Перед додаванням нового коду агент ПОВИНЕН:

1. ✅ Перевірити порядок підключення (CSS → CSRF → HTMX → scripts)
2. ✅ Перевірити, чи не дублюється з normalize.css
3. ✅ Перевірити, чи використовуються правильні HTMX атрибути
4. ✅ Перевірити CSRF token для форм
5. ✅ Переконатися, що немає inline styles
6. ✅ Переконатися, що використовується BEM naming для CSS
7. ✅ Переконатися, що немає зайвих бібліотек
8. ✅ Переконатися, що всі скрипти з defer

---

## БЕЗПЕКА ТА ЯКІСТЬ КОДУ

- Ніколи не використовувати eval() або подібні динамічні виконання коду
- Всі стилі в зовнішніх CSS файлах (ніяких inline styles)
- Використовувати класи замість ID для стилізації
- Дотримуватися принципів DRY (Don't Repeat Yourself)
- Валідація на сервері (не тільки на клієнті)
- Sanitization HTML відповідей від Django

---

## ДОКУМЕНТАЦІЯ

- CSS_STRUCTURE.md - структура CSS, normalize.css, BEM
- HTMX_USAGE.md - використання HTMX з Django, приклади
- README.md - загальний опис проекту

---

## ПІДСУМОК

**Мінімальний стек = максимальна продуктивність:**
- normalize.css (CSS нормалізація)
- HTMX (інтерактивність)
- Vanilla CSS + JS (тільки де потрібно)
- БЕЗ jQuery, core-js, Bootstrap JS, інших великих бібліотек

**Правильний порядок = відсутність конфліктів:**
CSS спочатку → HTMX потім → власні скрипти в кінці

**Жорсткі правила = безпомилкова робота:**
Дотримуйся правил вище, і проект буде працювати ідеально!

